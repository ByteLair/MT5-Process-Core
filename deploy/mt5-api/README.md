# MT5 Ingest API - Deploy artifacts

This folder contains files to deploy the MT5 ingest API on an Ubuntu 22.04 server.

Files:

- `schema.sql` - TimescaleDB schema: `ticks` hypertable, compression and retention policies, continuous aggregate `ohlc_1min`.
- `api.py` - FastAPI application for tick ingestion (`/tick/bulk`, `/tick`, `/health`, `/stats`).
- `requirements.txt` - Python dependencies.
- `.env` - Template environment variables (fill DB_PASSWORD and any overrides).
- `install.sh` - Installation script that installs Postgres + TimescaleDB, creates DB/user, applies schema, sets up venv, systemd, and ufw rules.
- `mt5-api.service` - systemd unit (packaging copy; place under `/etc/systemd/system/mt5-api.service`).
- `mt5_backup.sh` - Daily backup script to save compressed dumps to `/backup/mt5_data/` and keep last 7 backups.

Quick usage notes:

1. Copy files to the server (as root) and run `install.sh` or review it before running.
2. After installation the service is managed with:

```bash
sudo systemctl start mt5-api.service
sudo systemctl status mt5-api.service
sudo journalctl -u mt5-api.service -f
```

3. Health check:
```bash
curl http://127.0.0.1:8000/health
```

4. Test insert:
```bash
curl -X POST http://127.0.0.1:8000/tick -H "Content-Type: application/json" -d '{"symbol":"EURUSD","time":1234567890,"bid":1.12345,"ask":1.12356,"last":1.12350,"volume":100}'
```

5. Configure `/opt/mt5-api/.env` with real `DB_PASSWORD` (or copy `/root/.mt5_db_password` if generated by the installer).
